---
/**
 * Welcome — Hero with full-screen video, overlay copy, and CTA buttons.
 * Uses theme vars for background and text; video loads lazily and plays when in view.
 */
---

<div id="container">
	<video
		id="hero-video"
		data-video-src="https://res.cloudinary.com/dstaxkfml/video/upload/f_auto,q_auto:low/22370-vmake_h4mfr3.webm"
		autoplay
		muted
		loop
		playsinline
		preload="none"
	></video>
	<div id="hero-scrim" aria-hidden="true"></div>
	<header id="hero-content">
		<div id="hero-identity">Pankaj Sharma</div>
		<div id="hero-main">
			<p class="hero-label">Python Developer</p>
			<h1 class="hero-headline">Building fast and scalable backend systems.</h1>
			<p class="hero-description">I focus on automation, APIs, data extraction, and performance-driven development using Python.</p>
			<div class="hero-actions">
				<a href="#projects" class="btn btn-primary">View Projects</a>
				<a href="#contact" class="btn btn-secondary">Contact</a>
			</div>
		</div>
	</header>
</div>

<style is:global>
	/* Hero container: theme background so it respects light/dark */
	#container {
		position: relative;
		width: 100%;
		min-height: 100vh;
		overflow: hidden;
		contain: layout paint;
		background: var(--color-paper);
	}

	#hero-video {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		min-width: 100%;
		min-height: 100%;
		object-fit: cover;
		object-position: center;
		display: block;
		transform: translateZ(0);
		backface-visibility: hidden;
	}

	#hero-scrim {
		position: absolute;
		inset: 0;
		pointer-events: none;
	}

	#hero-content {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		display: flex;
		flex-direction: column;
		justify-content: center;
		padding: clamp(1.5rem, 5vw, 3rem) clamp(1.5rem, 6vw, 4rem);
		pointer-events: none;
	}
	#hero-content .hero-actions {
		pointer-events: auto;
	}

	#hero-identity {
		position: absolute;
		top: clamp(1.25rem, 4vw, 2rem);
		left: clamp(1.5rem, 6vw, 4rem);
		font-size: 1rem;
		font-weight: 600;
		letter-spacing: 0.02em;
		color: var(--color-ink);
	}

	#hero-main {
		max-width: 26rem;
	}

	.hero-label {
		margin: 0 0 0.625rem 0;
		font-size: 0.6875rem;
		font-weight: 500;
		letter-spacing: 0.16em;
		text-transform: uppercase;
		color: var(--color-ink);
	}

	.hero-headline {
		margin: 0 0 1rem 0;
		font-size: clamp(1.75rem, 4vw, 2.5rem);
		font-weight: 600;
		line-height: 1.15;
		letter-spacing: -0.025em;
		color: var(--color-ink);
	}

	.hero-description {
		margin: 0 0 1.625rem 0;
		font-size: 0.9375rem;
		line-height: 1.65;
		color: var(--color-ink);
	}

	.hero-actions {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
	}

	.btn {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		padding: 0.6875rem 1.375rem;
		font-size: 0.8125rem;
		font-weight: 500;
		letter-spacing: 0.03em;
		text-decoration: none;
		border-radius: 0.375rem;
		cursor: pointer;
	}

	.btn-primary {
		background: transparent;
		color: var(--color-ink);
		border: none;
	}

	.btn-secondary {
		background: transparent;
		color: var(--color-ink);
		border: none;
	}

	/* Mobile: top row — name left, block right; video scaled underneath */
	@media screen and (max-width: 768px) {
		#container {
			background: var(--color-paper);
		}
		#hero-video {
			object-fit: cover;
			object-position: center center;
			width: auto;
			height: 100%;
			top: 60%;
			left: 50%;
			transform: translate(-50%, -45%) scale(0.8);
			transform-origin: center center;
		}
		#hero-content {
			flex-direction: row;
			flex-wrap: wrap;
			justify-content: space-between;
			align-items: flex-start;
			padding: clamp(1.25rem, 4vw, 2rem) clamp(1rem, 4vw, 1.5rem);
			gap: 1rem;
		}
		#hero-identity {
			position: static;
		}
		#hero-main {
			max-width: 52%;
			text-align: right;
		}
		#hero-main .hero-actions {
			justify-content: flex-end;
		}
		.hero-headline {
			font-size: clamp(1.5rem, 6vw, 2rem);
		}
	}
</style>

<!-- Lazy-load hero video (Cache API when possible); play when in view, pause when not -->
<script>
	const CACHE_NAME = 'hero-video-v1';
	const videoEl = document.getElementById('hero-video') as HTMLVideoElement | null;
	const videoUrl = videoEl?.getAttribute('data-video-src') ?? '';
	if (!videoEl || !videoUrl) throw new Error('Hero video element or URL missing');
	const video = videoEl;

	function setVideoSourceFromBlob(v: HTMLVideoElement, blob: Blob) {
		const blobUrl = URL.createObjectURL(blob);
		v.src = blobUrl;
		v.load();
		v.play().catch(() => {});
		v.addEventListener('canplaythrough', () => URL.revokeObjectURL(blobUrl), { once: true });
	}

	function loadVideo() {
		const url = videoUrl as string;
		const tryCache = async () => {
			try {
				const cache = await caches.open(CACHE_NAME);
				const cached = await cache.match(url);
				if (cached) {
					const blob = await cached.blob();
					setVideoSourceFromBlob(video, blob);
					return;
				}
			} catch {
				// Cache not available (e.g. private mode), fall through to fetch
			}
			const res = await fetch(url);
			const blob = await res.blob();
			try {
				const cache = await caches.open(CACHE_NAME);
				await cache.put(url, new Response(blob, { headers: res.headers }));
			} catch {
				// Ignore cache write errors
			}
			setVideoSourceFromBlob(video, blob);
		};
		if ('requestIdleCallback' in window) {
			window.requestIdleCallback(() => tryCache(), { timeout: 1500 });
		} else {
			setTimeout(() => tryCache(), 300);
		}
	}

	loadVideo();

	const observer = new IntersectionObserver(
		(entries) => {
			const e = entries[0];
			if (!e || !video) return;
			if (e.isIntersecting) {
				video.play().catch(() => {});
			} else {
				video.pause();
			}
		},
		{ rootMargin: '20% 0px', threshold: 0 }
	);
	observer.observe(video);
</script>
<script is:inline>
	(function () {
		var script = document.createElement('script');
		script.src = 'https://unpkg.com/rough-notation@0.5.1/lib/rough-notation.iife.js';
		script.onload = function () {
			var annotate = window.RoughNotation && window.RoughNotation.annotate;
			if (!annotate) return;
			var buttons = document.querySelectorAll('#hero-content .hero-actions .btn');
			var opts = { type: 'box', color: 'gray', animate: true, strokeWidth: 1, duration: 600 };
			var isHover = window.matchMedia('(hover: hover)').matches;
			buttons.forEach(function (btn) {
				var annotation = null;
				if (isHover) {
					btn.addEventListener('mouseenter', function () {
						if (annotation) annotation.hide();
						annotation = annotate(btn, opts);
						annotation.show();
					});
					btn.addEventListener('mouseleave', function () {
						if (annotation) { annotation.hide(); annotation = null; }
					});
				} else {
					btn.addEventListener('click', function (e) {
						if (annotation) annotation.hide();
						annotation = annotate(btn, opts);
						annotation.show();
						setTimeout(function () {
							if (annotation) { annotation.hide(); annotation = null; }
						}, opts.duration + 100);
					});
				}
			});
		};
		document.head.appendChild(script);
	})();
</script>
